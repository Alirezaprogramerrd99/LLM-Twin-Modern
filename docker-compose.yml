services:
  api:
    build: .
    container_name: llm-twin-api
    ports:
      - "8000:8000"
    environment:
      # --- Mongo ---
      # Use service name "mongo" instead of localhost
      MONGO_URI: "mongodb://mongo:27017"
      USE_MONGO: "true"

      # --- Qdrant ---
      QDRANT_URL: "http://qdrant:6333"
      USE_QDRANT: "true"
      QDRANT_COLLECTION: "documents"

      # --- Embeddings ---
      # If you have these fields in Settings:
      EMBEDDING_MODEL_NAME: "sentence-transformers/all-MiniLM-L6-v2"

      # --- Ollama (running on Windows host) ---
      # Inside Docker on Windows, host.docker.internal points to the host machine
      OLLAMA_BASE_URL: "http://host.docker.internal:11434"
      OLLAMA_MODEL: "qwen3:4b"

      # --- App ---
      APP_ENV: "docker"
      DEBUG: "true"

    depends_on:
      - mongo
      - qdrant

  mongo:
    image: mongo:7
    container_name: llm-twin-mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  qdrant:
    image: qdrant/qdrant:latest
    container_name: llm-twin-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage

volumes:
  mongo_data:
  qdrant_data:
